<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<input id="c"/>
<input id="f" type="file">

<div id="receive"></div>
<button id="s">发送</button>
<button id="ss">发送2</button>
</body>

<script>
    var uid = Math.ceil(Math.random()*1000);
   var ws = new WebSocket('ws://127.0.0.1:3102/group/1/' + uid);
   // var ws = new WebSocket('ws://127.0.0.1:3009/test');
   //   var ws = new WebSocket('wss://chongliao.j-book.cn/ws/group/1/66');

    // var ws = new WebSocket('wss://chongliao.j-book.cn/ws?id=102&group_id=0');
    ws.onopen = function(){
        alert("连接成功");
    };
    ws.onmessage = function(e){
        document.getElementById("receive").innerText+=e.data+"</br>";
    };
    var btn = document.getElementById("s");
    var c = document.getElementById("c");

    btn.onclick=function(){
        var inputElement = document.getElementById("f");
        var fileList = inputElement.files;

//         for ( var i = 0; i < fileList.length; i++) {
//             console.log(fileList[i]);
//
//             //发送文件名
//             ws.send(fileList[i].name);
// //            reader.readAsBinaryString(fileList[i]);
// //读取文件　　
//             var reader = new FileReader();
//             reader.readAsArrayBuffer(fileList[i]);
// //文件读取完毕后该函数响应
//             reader.onload = function loaded(evt) {
//                 var binaryString = evt.target.result;
//                 // Handle UTF-16 file dump
//                 log("\n开始发送文件");
//                 ws.send(binaryString);
//             }
//         }

        message = JSON.stringify({
            email: "574543543@qq.com",
            user_id: uid.toString(),
            username: "fred",
            message: c.value, // Strip out html
            to_user_id:"0",
            group_id:"1",
            images:["http://chongliao.me/chongliao/2019/09/25/08/5d8b1f3c66acf.jpg"]
        });
        ws.send(message);
        document.getElementById("receive").innerText+=message+"</br>"
    };

    var btn2 = document.getElementById("ss");
    btn2.onclick=function(){

        var inputElement = document.getElementById("f");
        var fileList = inputElement.files;
        var binaryString;

        for ( var i = 0; i < fileList.length; i++) {
            alert(fileList[i].name);
            //发送文件名
            // ws.send(fileList[i].name);
            var reader = new FileReader();
            reader.readAsBinaryString(fileList[i]);
//读取文件　　
            var reader = new FileReader();
            reader.readAsArrayBuffer(fileList[i]);
//文件读取完毕后该函数响应

            reader.onload = function loaded(evt) {
                binaryString = evt.target.result;
                // Handle UTF-16 file dump
                console.log("\n开始发送文件");
                 ws.send(binaryString);
            }
        }

        message = JSON.stringify({
            email: "574543543@qq.com",
            user_id: uid.toString(),
            username: "fred",
            message: c.value, // Strip out html
            to_user_id:"0",
            group_id:"1",
            images:binaryString
        });
        ws.send(message);
        // ws.send(binaryString);
    }

</script>
</html>